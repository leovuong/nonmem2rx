---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# nonmem2rx

<!-- badges: start -->
[![R-CMD-check](https://github.com/nlmixr2/nonmem2rx/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/nlmixr2/nonmem2rx/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/nlmixr2/nonmem2rx/branch/main/graph/badge.svg)](https://app.codecov.io/gh/nlmixr2/nonmem2rx?branch=main)
[![CRAN version](http://www.r-pkg.org/badges/version/nonmem2rx)](https://cran.r-project.org/package=nonmem2rx)
[![CRAN total downloads](https://cranlogs.r-pkg.org/badges/grand-total/nonmem2rx)](https://cran.r-project.org/package=nonmem2rx)
[![CRAN total downloads](https://cranlogs.r-pkg.org/badges/nonmem2rx)](https://cran.r-project.org/package=nonmem2rx)
[![CodeFactor](https://www.codefactor.io/repository/github/nlmixr2/nonmem2rx/badge)](https://www.codefactor.io/repository/github/nlmixr2/nonmem2rx)
![r-universe](https://nlmixr2.r-universe.dev/badges/nonmem2rx)
<!-- badges: end -->

The goal of nonmem2rx is to convert a NONMEM control stream to a
`rxode2` (or even a `nlmixr2` fit) for easy clinical trial simulation
in R.

## Installation

You can install the development version of nonmem2rx from
[GitHub](https://github.com/) with the r-universe:

``` r
install.packages('nonmem2rx', repos = c('https://nlmixr2.r-universe.dev', 'https://cloud.r-project.org'))
```

When on CRAN, you can also get the CRAN version by:

``` r
install.packages('nonmem2rx')
```

## What you can do with `nonmem2rx`

- [Convert a `NONMEM` model to a `rxode2`
  model](https://nlmixr2.github.io/nonmem2rx/articles/import-nonmem.html)
  
- [Make sure the model is translated correctly](https://nlmixr2.github.io/nonmem2rx/articles/rxode2-validate.html)

- Then with this model, you can:

  - Perform [simulations of new
    dosing](https://nlmixr2.github.io/nonmem2rx/articles/simulate-new-dosing.html)
    from the NONMEM model or even [simulate using the uncertainty in your model](https://nlmixr2.github.io/nonmem2rx/articles/simulate-uncertainty.html)
    to simulate new scenarios
  
  - Modify the model for scenarios like adaptive dosing with model
    piping

- With `nonmem2rx` and `babelmixr2`, [convert the imported `rxode2`
  model to a `nlmixr2` object](https://nlmixr2.github.io/nonmem2rx/articles/convert-nlmixr2.html), allowing:
  
  - [Generation of Word and PowerPoint plots with `nlmixr2rpt`](https://nlmixr2.github.io/nonmem2rx/articles/create-office.html)
  
  - [Easy VPC creation (with `vpcPlot()`)](https://nlmixr2.github.io/nonmem2rx/articles/create-vpc.html)
  
  - [Easy Individual plots with extra solved
    points](https://nlmixr2.github.io/nonmem2rx/articles/create-augPred.html).
    This will show the curvature of individual and population fits for sparse
    data-sets (with `augPred()`)
    
- You can even use this conversion to help debug your NONMEM model (or
  even try it in `nlmixr2` instead)
  
  - Understand [how to simplify the NONMEM model to avoid rounding errors](https://nlmixr2.github.io/nonmem2rx/articles/read-rounding.html)
  
  - [Run `nlmixr2`'s covariance step when `NONMEM`s covariance step
    has
    failed](https://nlmixr2.github.io/nonmem2rx/articles/read-rounding.html#step-5-get-the-covariance-of-the-model)
    (in the linked example, there was no covariance step because
    rounding errors)
    
- This model could be a starting point for other types of models
    
  - Use model piping within `nlmixr2` to modify/fix parts of the model
    (and subsequent estimation in `nlmixr2` or even `NONMEM` with
    `babelmixr2`)
    
## Simple example

Once `nonmem2rx` has been loaded, you simply type the location of the
nonmem control stream for the parser to start.  For example:

```{r example}
library(nonmem2rx)
mod <- nonmem2rx(system.file("mods/cpt/runODE032.ctl", package="nonmem2rx"), lst=".res", save=FALSE)
mod
```

You can see this automatically validates NONMEM and rxode2 outputs for
a couple of metrics.

# External projects that contributed to the tool's validation

The `nonmem2rx` tool was validated against:

- The `PsN` library test suite of NONMEM listings
(https://github.com/UUPharmacometrics/PsN/tree/master/test)

- The ddmore model scrapings
  (https://github.com/dpastoor/ddmore_scraping).

- Models from NONMEM design tutorial Bauer 2021 https://doi.org/10.1002/psp4.12713

- Models from NONMEM tutorial 1 (Bauer 2019) https://doi.org/10.1002/psp4.12404

- Models from NONMEM tutorial 2 (Bauer 2019)  https://doi.org/10.1002/psp4.12422

Due to the sheer size of the zipped models for these nonmem control
stream sources, these are excluded to keep the binary below 3 mgs
(CRAN requirement).

However, I would like to acknowledge all who helped in these projects.
With these projects the NONMEM conversion to rxode2 has been made much
more robust.

Still, while the tests are not/will not be in the CRAN binaries, you
can test them yourself by:

1. Downloading this repository
2. Running the tests `devtools::test()`

