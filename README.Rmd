---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# nonmem2rx

<!-- badges: start -->
[![R-CMD-check](https://github.com/nlmixr2/nonmem2rx/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/nlmixr2/nonmem2rx/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/nlmixr2/nonmem2rx/branch/main/graph/badge.svg)](https://app.codecov.io/gh/nlmixr2/nonmem2rx?branch=main)
[![CRAN version](http://www.r-pkg.org/badges/version/nonmem2rx)](https://cran.r-project.org/package=nonmem2rx)
[![CRAN total downloads](https://cranlogs.r-pkg.org/badges/grand-total/nonmem2rx)](https://cran.r-project.org/package=nonmem2rx)
[![CRAN total downloads](https://cranlogs.r-pkg.org/badges/nonmem2rx)](https://cran.r-project.org/package=nonmem2rx)
[![CodeFactor](https://www.codefactor.io/repository/github/nlmixr2/nonmem2rx/badge)](https://www.codefactor.io/repository/github/nlmixr2/nonmem2rx)
![r-universe](https://nlmixr2.r-universe.dev/badges/nonmem2rx)
<!-- badges: end -->

The goal of nonmem2rx is to convert a NONMEM control stream to
`rxode2` for easy clinical trial simulation in R.

## Installation

You can install the development version of nonmem2rx from
[GitHub](https://github.com/) with the r-universe:

``` r
install.packages('nonmem2rx', repos = c('https://nlmixr2.r-universe.dev', 'https://cloud.r-project.org'))
```

When on CRAN, you can also get the CRAN version by:

``` r
install.packages('nonmem2rx')
```

## What you can do with `nonmem2rx`

- Convert a `NONMEM` model to a `rxode2` model. With this conversion you can:

  - Perform simulations of new dosing from the NONMEM model (with and
    without uncertainty in population parameters and between subject
    covariances)
  
  - Modify the model for scenarios like adaptive dosing with model
    piping

- Before you do all that, you can make sure the conversion matches
  `NONMEM`

- With `nonmem2rx` and `babelmixr2`, converted the imported `rxode2`
  model to a `nlmixr2` with residuals specified. This allows:
  
  - Generation of Word and PowerPoint plots with `nlmixr2rpt` because
    the goodness of fit plots can be created from this object
  
  - Easy VPC creation (with `vpcPlot()`)
  
  - Easy Individual plots with extra solved points to show the
    curvature of individual and population fits for sparse data-sets
    (with `augPred()`)
  
  - Understand how to simplify the NONMEM model to avoid rounding errors
  
  - Run `nlmixr2`'s covariance step when `NONMEM`s covariance step has
    failed
    
  - Use model piping within `nlmixr2` to modify/fix parts of the model
    (and subsequent estimation in `nlmixr2` or even `NONMEM` with
    `babelmixr2`)
    
## Example

Once `nonmem2rx` has been loaded, you simply type the location of the
nonmem control stream for the parser to start.  For example:

```{r example}
library(nonmem2rx)
mod <- nonmem2rx(system.file("mods/cpt/runODE032.ctl", package="nonmem2rx"), lst=".res", save=FALSE)
mod
```

You can see this automatically validates NONMEM and rxode2 outputs for
a couple of metrics.

# External projects that contributed to the tool's validation

The `nonmem2rx` tool was validated against:

- The `PsN` library test suite of NONMEM listings
(https://github.com/UUPharmacometrics/PsN/tree/master/test)

- The ddmore model scrapings
  (https://github.com/dpastoor/ddmore_scraping).

- Models from NONMEM design tutorial Bauer 2021 https://doi.org/10.1002/psp4.12713

- Models from NONMEM tutorial 1 (Bauer 2019) https://doi.org/10.1002/psp4.12404

- Models from NONMEM tutorial 2 (Bauer 2019)  https://doi.org/10.1002/psp4.12422

Due to the sheer size of the zipped models for these nonmem control
stream sources, these are excluded to keep the binary below 3 mgs
(CRAN requirement).

However, I would like to acknowledge all who helped in these projects.
With these projects the NONMEM conversion to rxode2 has been made much
more robust.

Still, while the tests are not/will not be in the CRAN binaries, you
can test them yourself by:

1. Downloading this repository
2. Running the tests `devtools::test()`

