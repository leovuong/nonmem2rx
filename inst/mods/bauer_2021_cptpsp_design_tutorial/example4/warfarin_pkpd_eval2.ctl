$PROBLEM WARFARIN PK/PD
$INPUT ID TIME AMT RATE EVID MDV DV CMT TSTRAT TMIN TMAX

$DATA warfarin_pkpd_eval2.csv ignore=C

$SUBROUTINES ADVAN13 TRANS1 TOL=12 ATOL=12

$MODEL NCOMPARTMENTS=3

$PK
MU_1=LOG(THETA(1))
MU_2=LOG(THETA(2))
MU_3=LOG(THETA(3))
MU_4=LOG(THETA(4))
MU_5=LOG(THETA(5))
MU_6=LOG(THETA(6))

KA=EXP(MU_1+ETA(1))
CL=EXP(MU_2+ETA(2))
V=EXP(MU_3+ETA(3))
RIN=EXP(MU_4+ETA(4))
IC50=EXP(MU_5+ETA(5))
KOUT=EXP(MU_6+ETA(6))
IMAX=1.0

S2=V
F1=1.0
A_0(3)=RIN/KOUT

$DES
DADT(1)=-KA*A(1)
DADT(2)=KA*A(1)-(CL/V)*A(2)
DADT(3)=RIN*(1.0-((IMAX*A(2)/V)/((A(2)/V)+IC50)))-KOUT*A(3)

$ERROR
IF(CMT==2) THEN
IPRED=A(2)/V
W=IPRED
Y=IPRED + W*EPS(1)
ENDIF
IF(CMT==3) THEN
IPRED=A(3)
W=1.0
Y=IPRED + W*EPS(2)
ENDIF


$THETA
1.60 ;[KA]
0.133 ;[CL]
7.95 ;[V]
5.41 ;[RIN]
1.20 ;[IC50]
0.056 ;[KOUT]

$OMEGA 0.701 0.063 0.020 0.190 0.013 0.016
$SIGMA 0.04 0.00150544

$DESIGN GROUPSIZE=26 FIMTYPE=1 VARCROSS=1
